{% load mptt_tags %}

<h1>Welcome to the Stage 1 Landing Page!</h1>

<ul>
  {% recursetree master_tree_set %}
        <li>
          <b>Content:</b> {{ node.content }}
          <br>
          <b> Id: </b> {{ node.id }}
          <br>
          <b>Voting Stage:</b> {{node.node_type}}
          <br>
          <b>Contributed Users:</b>
                <ul>
                  {% for user in node.users_contributed_set %}
                  <li>{{ user }}</li>
                  {% endfor %}
                </ul>
          <br>
          {% if user in node.users_contributed_set %}
          User has visited!
          {% else %}
          User has not visited here!
          <br>
          {% endif %}

          {% ifequal node.node_type 'F' %}

                <a href="{% url 'free entry' node.id %}">
                {% if user in node.users_contributed_set %}
                        View Final Choices for Node {{ node.id }}</a>
                {% else %}
                        Edit/Add Choices for Node {{ node.id }}</a><br>
                {% endif %}

          {% endifequal %}

          {% ifequal node.node_type 'P' %}
                {% if user in node.admin_set %}
                        <a href="{% url 'prune' node.id %}"> Prune for Node {{ node.id }}</a>
                {% else %}
                        User is not admin, but node is in pruning state
                {% endif %}
          {% endifequal %}

          {% ifequal node.node_type 'R' %}
                <a href="{% url 'rank' node.id %}">Ranking for Node {{ node.id }}</a>
          {% endifequal %}

          <p>
          {% if not node.is_leaf_node %}
                <ul class="children">
                  {{ children }}
                </ul>
          {% endif %}
        </li>
   {% endrecursetree %}
<p>
<p>
<p>
<p>
<br>
<br>
You are: {{ user.name }}
</ul>
